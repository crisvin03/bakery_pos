{% extends 'core/base.html' %}
{% load static %}
{% block content %}

<style>
  :root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    --info-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    --card-shadow: 0 20px 40px rgba(16,24,40,.08);
    --border-color: rgba(16,24,40,.08);
  }

  /* Enhanced Page Header */
  .page-head { 
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
    gap: 1.5rem; 
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 20px;
    border: 1px solid var(--border-color);
  }

  .page-head h2 {
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 800;
    letter-spacing: -0.025em;
  }

  .kpi {
    padding: 1rem 1.5rem;
    border: 1px solid var(--border-color);
    border-radius: 16px;
    background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
    box-shadow: var(--card-shadow);
    font-size: 1rem;
    font-weight: 600;
    position: relative;
    overflow: hidden;
  }

  .kpi::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--primary-gradient);
  }

  /* Enhanced Card */
  .card-elevated { 
    border: 1px solid var(--border-color); 
    border-radius: 20px; 
    box-shadow: var(--card-shadow);
    background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
    backdrop-filter: blur(20px);
    transition: all 0.3s ease;
  }

  .card-elevated:hover {
    transform: translateY(-2px);
    box-shadow: 0 25px 50px rgba(16,24,40,.12);
  }

  /* Enhanced Toolbar */
  .toolbar { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 1rem; 
    align-items: center; 
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 16px;
    margin-bottom: 1.5rem;
    border: 1px solid var(--border-color);
  }

  .toolbar .search { width: min(400px, 100%); }

  .btn-primary-gradient { 
    background: var(--primary-gradient); 
    border: none; 
    border-radius: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .btn-primary-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
  }

  .btn-primary-gradient:hover::before {
    left: 100%;
  }

  .btn-primary-gradient:hover { 
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  }

  /* Enhanced Search */
  .input-group {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,.05);
  }

  .input-group-text {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border: 2px solid var(--border-color);
    border-right: none;
  }

  .form-control {
    border: 2px solid var(--border-color);
    border-left: none;
    border-radius: 0 12px 12px 0;
    transition: all 0.2s ease;
  }

  .form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  /* Enhanced Table */
  .table {
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,.05);
  }

  .table thead th { 
    font-weight: 700; 
    color: #6b7280; 
    border-bottom-color: var(--border-color);
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.8rem;
    padding: 1rem;
  }

  .table tbody td { 
    vertical-align: middle; 
    padding: 1rem;
    border-bottom: 1px solid rgba(0,0,0,.04);
  }

  .table-hover>tbody>tr:hover>* { 
    background: linear-gradient(135deg, #fafbff 0%, #f1f5f9 100%);
    transform: scale(1.01);
    transition: all 0.2s ease;
  }

  .table-sticky thead th { 
    position: sticky; 
    top: 0; 
    z-index: 5; 
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  }

  /* Enhanced Product Images */
  .thumb { 
    width: 60px; 
    height: 60px; 
    border-radius: 16px; 
    object-fit: cover;
    background: linear-gradient(135deg, #f1f3f5 0%, #e2e8f0 100%);
    border: 2px solid var(--border-color);
    box-shadow: 0 4px 12px rgba(0,0,0,.1);
    transition: all 0.3s ease;
  }

  .thumb:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0,0,0,.15);
  }

  /* Enhanced Status */
  .status-dot { 
    width: 12px; 
    height: 12px; 
    border-radius: 50%; 
    display: inline-block; 
    margin-right: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,.2);
  }

  .status-dot.bg-success {
    background: var(--success-gradient);
  }

  .status-dot.bg-secondary {
    background: linear-gradient(135deg, #6c757d, #495057);
  }

  /* Enhanced Typography */
  .num { 
    font-variant-numeric: tabular-nums; 
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-weight: 600;
  }

  /* Enhanced Actions */
  .actions .btn { 
    padding: 0.5rem 0.75rem; 
    border-radius: 10px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .actions .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,.15);
  }

  .btn-outline-secondary {
    border: 2px solid #6c757d;
    color: #6c757d;
    background: rgba(108, 117, 125, 0.05);
  }

  .btn-outline-secondary:hover {
    background: linear-gradient(135deg, #6c757d, #495057);
    border-color: transparent;
    color: white;
  }

  .btn-outline-danger {
    border: 2px solid #dc3545;
    color: #dc3545;
    background: rgba(220, 53, 69, 0.05);
  }

  .btn-outline-danger:hover {
    background: linear-gradient(135deg, #dc3545, #c82333);
    border-color: transparent;
    color: white;
  }

  /* Enhanced Empty State */
  .empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: #6b7280;
    background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
    border: 2px dashed var(--border-color);
    border-radius: 20px;
    transition: all 0.3s ease;
  }

  .empty-state:hover {
    border-color: #667eea;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  }

  /* Loading Animation */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(102, 126, 234, 0.3);
    border-radius: 50%;
    border-top-color: #667eea;
    animation: spin 1s ease-in-out infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Responsive Design */
  @media (max-width: 576px) { 
    .hide-sm { display: none; }
    .page-head {
      flex-direction: column;
      text-align: center;
    }
    .toolbar {
      flex-direction: column;
      align-items: stretch;
    }
    .toolbar .search {
      width: 100%;
    }
  }

  /* Product Card Hover Effects */
  .product-row {
    transition: all 0.3s ease;
  }

  .product-row:hover {
    background: linear-gradient(135deg, #fafbff 0%, #f1f5f9 100%);
    transform: translateX(4px);
  }

  /* Enhanced Icons */
  .icon-enhanced {
    filter: drop-shadow(0 2px 4px rgba(0,0,0,.1));
  }

  /* Icon Container */
  .icon-container {
    width: 48px;
    height: 48px;
    border-radius: 16px;
    background: var(--primary-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
  }

  .icon-container:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
  }

  /* Enhanced KPI Icon */
  .kpi-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: var(--primary-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.25);
    transition: all 0.3s ease;
  }

  .kpi-icon:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);
  }

  /* Enhanced KPI Card */
  .kpi {
    position: relative;
    overflow: hidden;
  }

  .kpi::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    50% { transform: translate(-20px, -20px) rotate(180deg); }
  }

  /* Enhanced Page Head */
  .page-head {
    position: relative;
    overflow: hidden;
  }

  .page-head::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-gradient);
  }

</style>

<div class="page-head">
  <div class="d-flex align-items-center">
    <div class="me-3">
      <div class="icon-container">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" class="icon-enhanced">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      </div>
    </div>
    <div>
      <h2 class="h3 mb-1">üçû Products</h2>
      <div class="text-secondary">Manage your bakery catalog and inventory</div>
    </div>
  </div>
  <div class="kpi">
    <div class="d-flex align-items-center">
      <div class="me-3">
        <div class="kpi-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
      </div>
      <div>
        <div class="fw-bold fs-4 text-primary">{{ products|length }}</div>
        <div class="small text-muted fw-semibold">Total Products</div>
      </div>
    </div>
  </div>

</div>

<div class="card card-elevated">
  <div class="card-body">
    <div class="toolbar">
      <!-- Enhanced Search -->
      <form method="get" id="searchForm" class="d-flex search" action="/products/">
        <div class="input-group">
          <span class="input-group-text">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="icon-enhanced">
              <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5L20.5 19l-5-5Zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14Z"/>
            </svg>
          </span>
          <input id="q" type="search" name="q"
                 value="{{ q|default:'' }}"
                 class="form-control"
                 placeholder="Search products by name or ingredients...">
        </div>
        <button class="btn btn-outline-primary ms-2" type="submit">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-1">
            <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5L20.5 19l-5-5Zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14Z"/>
          </svg>
          Search
        </button>
      </form>

      <!-- Enhanced Add Button -->
      <a href="/products/new/" class="btn btn-primary-gradient text-white ms-auto">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2 icon-enhanced">
          <path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6Z"/>
        </svg>
        ‚ú® New Product
      </a>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle table-sticky mb-0">
        <thead>
          <tr>
            <th style="width:80px">üñºÔ∏è Image</th>
            <th>üì¶ Product Details</th>
            <th class="text-end hide-sm" style="width:160px">üí∞ Price</th>
            <th class="hide-sm" style="width:140px">üìä Status</th>
            <th class="text-end" style="width:180px">‚öôÔ∏è Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for p in products %}
          <tr class="product-row">
            <td>
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="{{ p.name }}" class="thumb">
              {% else %}
                <div class="thumb d-flex align-items-center justify-content-center">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" style="opacity: 0.6;">
                    <path d="M6 15l3-3 2 2 3-4 4 6H6z"/>
                  </svg>
                </div>
              {% endif %}
            </td>
            <td>
              <div class="fw-bold fs-6 mb-1">{{ p.name }}</div>
              {% if p.ingredients %}
                <div class="text-secondary small text-truncate" style="max-width:520px">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="me-1" style="opacity: 0.6;">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                  {{ p.ingredients }}
                </div>
              {% endif %}
            </td>
            <td class="text-end hide-sm">
              <div class="num fw-bold text-success fs-5">‚Ç±{{ p.price|floatformat:2 }}</div>
            </td>
            <td class="hide-sm">
              {% if p.is_active %}
                <span class="badge bg-success d-inline-flex align-items-center">
                  <span class="status-dot bg-white me-1"></span>
                  Active
                </span>
              {% else %}
                <span class="badge bg-secondary d-inline-flex align-items-center">
                  <span class="status-dot bg-white me-1"></span>
                  Inactive
                </span>
              {% endif %}
            </td>
            <td class="text-end actions">
              <div class="btn-group" role="group" aria-label="Actions">
                <a class="btn btn-outline-secondary" href="/products/{{ p.id }}/edit/" data-bs-toggle="tooltip" title="‚úèÔ∏è Edit Product">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="icon-enhanced">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25Zm2.92 2.33H5v-.92l8.06-8.06.92.92-8.06 8.06ZM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83Z"/>
                  </svg>
                </a>
                <a class="btn btn-outline-danger" href="/products/{{ p.id }}/delete/" data-bs-toggle="tooltip" title="üóëÔ∏è Delete Product">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="icon-enhanced">
                    <path d="M6 7h12v2H6V7Zm2 3h8l-.8 9.6A2 2 0 0 1 13.21 22h-2.42A2 2 0 0 1 8.8 19.6L8 10Zm3-7h4l1 1h3v2H4V4h3l1-1h4Z"/>
                  </svg>
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center py-5">
              <div class="empty-state">
                <div class="mb-3">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" style="opacity: 0.6;">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                </div>
                <h5 class="mb-2">üì¶ No Products Found</h5>
                <p class="mb-3 text-muted">Start building your bakery catalog by adding your first product.</p>
                <a href="/products/new/" class="btn btn-primary-gradient text-white">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
                    <path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6Z"/>
                  </svg>
                  Add Your First Product
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // Enhanced Bootstrap tooltips with better styling
  document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
    new bootstrap.Tooltip(el, {
      placement: 'top',
      trigger: 'hover focus',
      customClass: 'custom-tooltip'
    });
  });

  // Enhanced search functionality
  (function () {
    const form = document.getElementById('searchForm');
    const input = document.getElementById('q');
    const base = form.getAttribute('action') || window.location.pathname;
    let searchTimeout;

    // Add loading state to search
    function showSearchLoading() {
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<div class="loading me-2"></div> Searching...';
      submitBtn.disabled = true;
      
      setTimeout(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }, 1000);
    }

    // Auto-restore full list when search field becomes empty
    function maybeReset() {
      if (input.value.trim() === '' && new URLSearchParams(location.search).has('q')) {
        showSearchLoading();
        setTimeout(() => {
          window.location.replace(base);
        }, 500);
      }
    }

    // Debounced search
    function debouncedSearch() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        if (input.value.trim() !== '') {
          showSearchLoading();
          form.submit();
        }
      }, 500);
    }

    input.addEventListener('input', debouncedSearch);
    input.addEventListener('search', maybeReset);

    // Add search suggestions (placeholder for future enhancement)
    input.addEventListener('focus', function() {
      this.style.borderColor = '#667eea';
      this.style.boxShadow = '0 0 0 3px rgba(102, 126, 234, 0.1)';
    });

    input.addEventListener('blur', function() {
      this.style.borderColor = '';
      this.style.boxShadow = '';
    });
  })();

  // Enhanced product row interactions
  document.querySelectorAll('.product-row').forEach(row => {
    row.addEventListener('mouseenter', function() {
      this.style.transform = 'translateX(4px)';
      this.style.boxShadow = '0 8px 20px rgba(0,0,0,.1)';
    });

    row.addEventListener('mouseleave', function() {
      this.style.transform = '';
      this.style.boxShadow = '';
    });
  });

  // Add keyboard shortcuts
  document.addEventListener('keydown', function(e) {
    // Ctrl+F to focus search
    if (e.ctrlKey && e.key === 'f') {
      e.preventDefault();
      document.getElementById('q').focus();
    }
    
    // Ctrl+N to create new product
    if (e.ctrlKey && e.key === 'n') {
      e.preventDefault();
      window.location.href = '/products/new/';
    }
  });

  // Add smooth animations
  document.addEventListener('DOMContentLoaded', function() {
    // Animate cards on load
    const cards = document.querySelectorAll('.card-elevated');
    cards.forEach((card, index) => {
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      
      setTimeout(() => {
        card.style.transition = 'all 0.5s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, index * 100);
    });

    // Animate table rows
    const rows = document.querySelectorAll('.product-row');
    rows.forEach((row, index) => {
      row.style.opacity = '0';
      row.style.transform = 'translateX(-20px)';
      
      setTimeout(() => {
        row.style.transition = 'all 0.3s ease';
        row.style.opacity = '1';
        row.style.transform = 'translateX(0)';
      }, 200 + (index * 50));
    });
  });
</script>
{% endblock %}

